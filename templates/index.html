<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PolyPersona</title>

    <!-- Favicon -->
    <link
      rel="shortcut icon"
      href="{{ url_for('static', filename='favicon/favicon.png') }}"
      type="image/x-icon"
    />

    <!-- Custom CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/index.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/cards_slider.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/model_parameters.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/loading.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/footer.css') }}"
    />
  </head>

  <body class="greek-theme">
    <h1 class="title" data-value="PolyPersona">PolyPersona</h1>

    <!-- Description -->
    {% include "description.html" %}

    <!-- Cards Slider -->
    {% include "cards_slider.html" %}

    <!-- Input & Output -->
    {% include "io.html" %}

    <!-- Footer -->
    {% include "footer.html" %}

    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
    <script>
      // Model Parameters Section
      function showTemperatureValue(val) {
        document.getElementById("temperatureValue").textContent = val;
      }
      function showTopKValue(val) {
        document.getElementById("top_kValue").textContent = val;
      }
      function showTopPValue(val) {
        document.getElementById("top_pValue").textContent = val;
      }
      // Show information on hover
      function showInfo(val) {
        document.querySelector("#info-" + val).style.display = "block";
      }
      // Hide information on hover
      function hideInfo(val) {
        document.querySelector("#info-" + val).style.display = "none";
      }

      // Sample Celebs Section
      function submitSampleCeleb(text) {
        // Format of text: "Celeb - What_to_say"
        const splitText = text.split(" - ");
        const celeb = splitText[0];
        const whatToSay = splitText[1];

        // Set the input value
        const name = document.getElementById("name");
        const whatToSayInput = document.getElementById("say");
        name.value = celeb;
        whatToSayInput.value = whatToSay;

        // Submit the form
        showLoadingAnimation(); // Trigger loading animation
        form.submit(); // Submit the form
      }

      // Loading Section
      const loading = document.getElementById("loading");
      window.onload = () => {
        loading.style.display = "none"; // Hide the loading section when the page is loaded
      };
      const form = document.getElementById("input-form");
      form.addEventListener("submit", () => {
        showLoadingAnimation(); // Trigger loading animation
      });
      // Submit if the user presses Enter
      document.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          showLoadingAnimation(); // Trigger loading animation
          form.submit(); // Submit the form
        }
      });
      // Function to display loading section and animate loading text
      function showLoadingAnimation() {
        const loading = document.getElementById("loading");
        loading.style.display = "flex"; // Show the loading section
        loading.scrollIntoView({ behavior: "smooth" }); // Scroll to the loading section
        const loadingText = document.getElementById("loading-text");
        const text = loadingText.textContent;
        loadingText.textContent = ""; // Clear the text content

        // Animate the loading text
        let index = 0;
        const interval = setInterval(() => {
          if (index < text.length) {
            loadingText.textContent += text.charAt(index);
            index++;
          } else {
            clearInterval(interval);
          }
        }, 100); // 100ms interval

        // Animate "", ".", "..", "..."
        // Only animate this after the initial text is displayed, i.e., wait for the initial text to be displayed
        const dots = ["", ".", "..", "..."];
        setTimeout(() => {
          let i = 0;
          const interval = setInterval(() => {
            loadingText.textContent = text + dots[i];
            i = (i + 1) % dots.length;
          }, 500); // 500ms interval
        }, text.length * 100); // Wait for the initial text to be displayed

        // Scroll to the loading section
        loading.scrollIntoView({ behavior: "smooth" });
      }

      // Scroll to the result section if it exists
      const result = document.getElementById("result");
      if (result) {
        result.scrollIntoView({ behavior: "smooth" });
      }

      // Translate Response Section
      function translateResponse() {
        // Get the target language
        const target_lang = document.getElementById("translate").value;
        // Get the original language
        const original_lang =
          document.getElementById("response-lang").textContent;
        // Get the text to be translated
        const text = document.getElementById("response-text").textContent;
        // Set the content of p tag with id="translate-loading" to "Loading..."
        document.getElementById("translate-loading").textContent = "Loading...";
        // API call
        fetch("/translate_api", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            text: text,
            target_lang: target_lang,
            original_lang: original_lang,
          }),
        })
          .then((response) => response.json()) // Parse the JSON response
          .then((data) => {
            // Display the translated text
            const responseText = document.getElementById("response-text");
            responseText.textContent = data.translated_text;
            // Change to translated audio
            const responseAudio = document.getElementById("response-audio");
            responseAudio.innerHTML = `<source id="response-audio" src="data:audio/mpeg;base64,${data.audio_base64}" type="audio/mpeg" />Your browser does not support the audio element.`;

            // Set the original language to the translated language
            document.getElementById("response-lang").textContent = target_lang;
            // Clear the content of p tag with id="translate-loading"
            document.getElementById("translate-loading").textContent = "";
          });
      }
    </script>
  </body>
</html>
